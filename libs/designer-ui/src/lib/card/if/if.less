@import (reference) '../../variables.less';

@conditionSelectedBorder: 2px solid #464f59;

.msla-if {
  box-sizing: border-box;
  display: flex;

  .msla-condition-collapsed {
    margin: 0 auto;
    min-width: @collapsed-card-min-width;
    border: @defaultBorder;

    @media only screen and (max-width: @designer-desktop-max-width) {
      max-width: @card-max-width;
      min-width: @card-min-width;
      width: 100%;
    }
  }

  .msla-condition-expanded {
    border-collapse: collapse;
    display: table;
    margin: 0 auto;
    min-width: @collapsed-card-min-width;

    /* WORKAROUND Disable table-cell display to stack the branches when on mobile */
    @media only screen and (max-width: @designer-desktop-max-width) {
      /* We need to put 100% for mobile as part of block display */
      min-width: @card-min-width;
      width: 100%;

      .msla-condition-single {
        max-width: @card-max-width;
      }

      .msla-card-body {
        padding: 0;

        .msla-parameter-group {
          padding-bottom: 5px;
        }
      }
    }

    & > div {
      display: table-row;

      & > div {
        display: table-cell;
      }
    }
  }

  & > div > div > div > .msla-card {
    background-color: inherit;
    border: none;
    outline: none;
    box-shadow: none;

    & > .msla-card-body {
      & > .msla-error,
      & > .msla-comment-box,
      & > .msla-information-box-container {
        margin: 0 auto;
        border: @defaultBorder;
        border-top: none;
        border-bottom: none;

        &.msla-fixed-width {
          max-width: @card-max-width;
        }
      }

      & > .msla-comment-box {
        background-color: @scope-background-color;
      }
    }

    &.msla-card-selected {
      border-color: transparent;

      & > .msla-card-header {
        border: @border;
        border-bottom: none;
        box-shadow: 0 -2px 12px @selectedShadowColor;
      }

      & > .msla-card-body {
        & > .msla-error,
        & > .msla-comment-box,
        & > .msla-information-box-container {
          border: @conditionSelectedBorder;
          border-top: none;
          border-bottom: none;
        }
      }
    }

    & > .msla-card-header,
    & > .msla-card-menus {
      margin: 0 auto;

      &.msla-header-fixed-width {
        max-width: @card-max-width;
      }
    }

    & > .msla-card-body {
      padding: 0;

      & > .msla-card-condition-body {
        background-color: inherit;
        border-spacing: 10px;
        border-collapse: separate;
        box-sizing: border-box;
        display: block;
        text-align: center;
        font-family: 'Segoe UI', sans-serif;

        /* WORKAROUND Disable table-cell display to stack the branches when on mobile */
        @media only screen and (max-width: @designer-desktop-max-width) {
          /* We need to put 100% for mobile as part of block display */
          width: 100%;
          min-width: @card-min-width;

          &.msla-condition-single {
            max-width: @card-max-width;
          }
        }

        & > .msla-card-condition-parameters {
          background-color: @scope-background-color;
          display: block;
          margin: 0 auto 0;

          &.msla-condition-single {
            max-width: @card-max-width;
          }

          &.msla-condition-rules {
            display: inline-block;
            min-width: @card-max-width;
          }

          & > .msla-card-condition-parameters-body {
            margin: 0 auto;
            padding: @parameter-inputbox-start-padding;

            &.no-padding {
              padding: 0;
            }

            &.msla-monitoring-parameters-card-body {
              border: @border;
              max-width: @card-max-width;
              padding: 0;
              text-align: left;
            }
          }
        }

        & > .msla-card-condition-branches {
          display: block;

          & > .msla-card-condition-branch {
            background-color: transparent;
            background-clip: padding-box;
            box-sizing: content-box;
            display: table-cell;
            min-width: @card-max-width;
            position: relative;
            vertical-align: top;

            /* WORKAROUND Disable table-cell display to stack the branches when on mobile */
            @media only screen and (max-width: @designer-desktop-max-width) {
              display: block;
              margin: 10px -10px 1em;
              min-width: @card-min-width;
            }

            .msla-card.msla-card-variable-width {
              border-collapse: collapse;
            }

            & > .msla-card-scope-body {
              background-color: inherit;

              & > .msla-card-scope-body-canvas {
                &.msla-action-palette-visible {
                  padding-bottom: 36px;
                  /* height of action palette bar */
                }
              }

              & > .msla-scope-bottom {
                bottom: 1em;
                position: absolute;
                width: 100%;
              }
            }
          }
        }
      }
    }
  }

  .msla-condition-collapsed {
    & > div > div > .msla-card {
      &.msla-card-selected {
        & > .msla-card-header {
          border: @conditionSelectedBorder;
          box-shadow: 0 0 12px @selectedShadowColor;
        }
      }
    }
  }

  .msla-condition-expanded {
    & > div > div > .msla-card {
      & > .msla-card-header {
        border: @defaultBorder;
        border-bottom: none;
        box-sizing: border-box;
        height: (@card-header-height + 2px);
        /* icon height + border */
      }

      & > .msla-card-body > .msla-card-condition-body > .msla-card-condition-parameters {
        border-bottom: @defaultBorder;
        border-left: @defaultBorder;
        border-right: @defaultBorder;
        box-sizing: border-box;
      }

      &.msla-card-selected {
        & > .msla-card-header {
          border: @conditionSelectedBorder;
          border-bottom: none;
        }

        & > .msla-card-body > .msla-card-condition-body > .msla-card-condition-parameters {
          border-bottom: @conditionSelectedBorder;
          border-left: @conditionSelectedBorder;
          border-right: @conditionSelectedBorder;
        }
      }
    }

    .msla-card-caption {
      .msla-card {
        &.msla-card-fixed-width {
          .msla-card-header {
            border: none;
          }
        }
      }
    }
  }
}

/* NOTE(joechung): Disable narrow viewport workaround when panel mode is enabled. */
.msla-main-page {
  .msla-if {
    display: inline-flex;

    .msla-condition-expanded {
      /* WORKAROUND Disable table-cell display to stack the branches when on mobile */
      @media only screen and (max-width: @designer-desktop-max-width) {
        /* We need to put 100% for mobile as part of block display */
        min-width: 0;
        width: auto;
      }
    }
  }
}

.msla-designer-canvas.msla-panel-mode {
  .msla-if {
    .msla-condition-expanded {
      min-width: auto;

      .msla-condition-control-container {
        padding-bottom: 10px;
        text-align: center;

        &.dragging {
          opacity: 0.7;
        }

        .msla-card-condition-branches {
          display: block;
          margin-top: 40px;
          min-width: inherit;

          .msla-card-condition-branch {
            background-color: transparent;
            background-clip: padding-box;
            box-sizing: content-box;
            display: table-cell;
            position: relative;
            vertical-align: top;
            margin: 5px;
          }
        }
      }
    }

    .msla-condition-collapsed {
      border: 0;
      min-width: inherit;

      .msla-condition-control-container {
        &.dragging {
          opacity: 0.7;
        }
      }
    }
  }
}

.msla-tab-component-container {
  .msla-if {
    .msla-condition-expanded {
      & > div > div > .msla-card {
        &.msla-card-selected {
          & > .msla-card-header {
            border: none;
            border-bottom: none;
          }

          & > .msla-card-body > .msla-card-condition-body > .msla-card-condition-parameters {
            border-bottom: none;
            border-left: none;
            border-right: none;
          }
        }
      }
    }
  }
}

body.dark {
  .msla-if {
    .msla-condition-collapsed {
      border-color: @ms-color-neutralTertiary;
    }

    & > div > div > div > .msla-card {
      background-color: inherit;

      & > .msla-card-body {
        & > .msla-comment-box {
          background-color: @ms-color-white;
        }

        & > .msla-card-condition-body {
          background-color: inherit;

          & > .msla-card-condition-parameters {
            background-color: @ms-color-white;
          }

          & > .msla-card-condition-branches {
            & > .msla-card-condition-branch {
              & > .msla-card-scope-body {
                background-color: @ms-color-neutralPrimary;
              }
            }
          }
        }
      }
    }
  }

  .msla-main-page {
    .msla-if {
      & > div > div > div > .msla-card {
        & > .msla-card-body {
          & > .msla-comment-box {
            background-color: inherit;
          }
        }
      }
    }
  }

  .msla-panel-root {
    .msla-if {
      & > div > div > div > .msla-card {
        & > .msla-card-body {
          & > .msla-card-condition-body {
            & > .msla-card-condition-parameters {
              background-color: inherit;
            }
          }
        }
      }
    }
  }
}
