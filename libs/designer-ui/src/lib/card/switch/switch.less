@import (reference) '../../variables.less';

@switchSelectedBorder: 2px solid #464f59;

.msla-switch {
  box-sizing: border-box;
  display: flex;

  .msla-switch-collapsed {
    margin: 0 auto;
    min-width: @collapsed-card-min-width;
    border: @defaultBorder;

    @media only screen and (max-width: @designer-desktop-max-width) {
      max-width: @card-max-width;
      min-width: @card-min-width;
      width: 100%;
    }
  }

  .msla-switch-expanded {
    border-collapse: collapse;
    display: table;
    margin: 0 auto;
    min-width: @collapsed-card-min-width;

    .msla-card-switch-on-body {
      background-color: inherit;
      border-collapse: collapse;
      box-sizing: border-box;
      display: table;
      font-family: @font-family;
      width: 100%;

      /* WORKAROUND Disable table-cell display to stack the branches when on mobile */
      @media only screen and (max-width: @designer-desktop-max-width) {
        /* We need to put 100% for mobile as part of block display */
        width: 100%;
        min-width: @card-min-width;
        max-width: @card-max-width;
      }

      .msla-card-switch-on-parameters {
        background-color: @scope-background-color;
        display: table-caption;
        margin: 0 auto 1em;
        max-width: @card-max-width;

        .msla-card-switch-on-parameters-body {
          margin: 0 auto;
          padding: @parameter-inputbox-start-padding;

          .msla-input-parameter {
            display: flex;
            flex-wrap: wrap;

            .msla-input-parameter-wrapper {
              flex: 1 1 100%;
              padding: 1px;

              .msla-editor-input-control {
                padding: 1px;
              }

              .msla-input-parameter-box {
                width: 100%;
                padding-top: 2px;
                padding-bottom: 2px;
              }
            }

            .msla-input-parameter-content-wrapper {
              flex: 1 1 436px;
              width: calc(100% - @parameter-label-width - 2px);
            }

            @media only screen and (max-width: @designer-desktop-max-width) {
              .msla-input-parameter-content-wrapper {
                width: 100%;
                flex-basis: 100%;
              }
            }
          }

          &.msla-monitoring-parameters-card-body {
            border: @border;
            max-width: @card-max-width;
          }
        }
      }

      .msla-card-switch-branches-body {
        display: table-row;

        .msla-card-variable-width {
          display: inline-block;
          margin-right: 5px;
        }

        .msla-card-switch-branch-cell-area {
          display: table-cell;
          padding-right: 5px;
          vertical-align: top;

          .msla-card-scope-body {
            padding-bottom: 5px;
          }
        }
      }
    }

    & > .msla-card-switch-on-body-more-cases {
      background-color: inherit;
      border-collapse: collapse;
      box-sizing: border-box;
      display: table;
      font-family: @font-family;
      width: 100%;
      min-width: @card-min-width;
      max-width: @card-max-width;

      & > .msla-card-switch-on-parameters {
        background-color: @scope-background-color;
        display: table-caption;
        margin: 0 auto 1em;
        max-width: @card-max-width;

        & > .msla-card-switch-on-parameters-body {
          border: @defaultBorder;
          margin: 0 auto;
          padding: 0.5em;

          &.msla-monitoring-parameters-card-body {
            border: @border;
            max-width: @card-max-width;
          }
        }
      }

      & > .msla-card-switch-branches-body {
        & > .msla-card-variable-width {
          display: inline-block;
          margin-bottom: 5px;
        }

        & > .msla-icon-button {
          margin-right: 5px;
        }

        & > .msla-card-switch-icon-button-area {
          display: inline-block;
          margin-left: 200px;
        }

        & > .msla-card-switch-branch-stacked-area {
          margin-bottom: 5px;

          .msla-card-scope-body {
            padding-bottom: 5px;
          }
        }

        & > .msla-card-switch-branch-stacked-default-area {
          margin-top: 5px;

          .msla-card-scope-body {
            padding-bottom: 5px;
          }
        }
      }
    }

    /* WORKAROUND Disable table-cell display to stack the branches when on mobile */
    @media only screen and (max-width: @designer-desktop-max-width) {
      /* We need to put 100% for mobile as part of block display */
      max-width: @card-max-width;
      min-width: @card-min-width;
      width: 100%;

      .msla-card-body {
        padding: 0;

        .msla-parameter-group {
          padding-bottom: 5px;
        }
      }
    }

    & > div {
      display: table-row;

      & > div {
        display: table-cell;
      }
    }
  }

  & > div > div > div > .msla-card {
    background-color: inherit;
    border: none;
    box-shadow: none;

    & > .msla-card-body {
      & > .msla-error,
      & > .msla-comment-box,
      & > .msla-information-box-container {
        margin: 0 auto;
        max-width: @card-max-width;
        background-color: @scope-background-color;
        border: @defaultBorder;
        border-top: none;
        border-bottom: none;
      }
    }

    &.msla-card-selected {
      border-color: transparent;

      & > .msla-card-header {
        border: @border;
        border-bottom: none;
        box-shadow: 0 -2px 12px @selectedShadowColor;
      }

      & > .msla-card-body {
        & > .msla-error,
        & > .msla-comment-box,
        & > .msla-information-box-container {
          border: @switchSelectedBorder;
          border-top: none;
          border-bottom: none;
        }
      }
    }

    & > .msla-card-header,
    & > .msla-card-menus {
      margin: 0 auto;
      max-width: @card-max-width;
    }

    & > .msla-card-body {
      padding-top: 0;
    }
  }

  .msla-error {
    max-width: @card-max-width;

    .msla-error-text {
      font-family: @font-family;
    }
  }

  .msla-switch-collapsed {
    & > div > div > .msla-card {
      &.msla-card-selected {
        & > .msla-card-header {
          border: @switchSelectedBorder;
          box-shadow: 0 0 12px @selectedShadowColor;
        }
      }
    }
  }

  .msla-switch-expanded {
    & > div > div > .msla-card {
      & > .msla-card-header {
        border: @defaultBorder;
        border-bottom: none;
        box-sizing: border-box;
        height: (@card-header-height + 2px);
        /* icon height + border */
      }

      & > .msla-card-body > .msla-card-switch-on-body > .msla-card-switch-on-parameters {
        border-bottom: @defaultBorder;
        border-left: @defaultBorder;
        border-right: @defaultBorder;
        box-sizing: border-box;
      }

      &.msla-card-selected {
        & > .msla-card-header {
          border: @switchSelectedBorder;
          border-bottom: none;
        }

        & > .msla-card-body > .msla-card-switch-on-body > .msla-card-switch-on-parameters {
          border-bottom: @switchSelectedBorder;
          border-left: @switchSelectedBorder;
          border-right: @switchSelectedBorder;
        }
      }
    }
  }
}

/* NOTE(joechung): Disable responsive rendering when drawing switch branches in panel mode. */
.msla-designer-canvas:not(.msla-panel-mode) {
  .msla-switch .msla-switch-expanded .msla-card-switch-on-body .msla-card-switch-branches-body {
    .msla-card-variable-width {
      @media only screen and (max-width: @designer-desktop-max-width) {
        margin-bottom: 5px;
      }
    }

    .msla-icon-button {
      @media only screen and (max-width: @designer-desktop-max-width) {
        margin-right: 0;
      }
    }

    .msla-card-switch-branch-cell-area {
      @media only screen and (max-width: @designer-desktop-max-width) {
        display: block;
        margin-bottom: 10px;
        text-align: center;
      }
    }
  }
}

.msla-main-page {
  .msla-switch {
    display: inline-flex;
  }
}

.msla-designer-canvas.msla-panel-mode {
  .msla-switch {
    .msla-switch-expanded {
      min-width: auto;
      border-collapse: separate;

      .msla-card-switch-on-body {
        margin-top: 40px;
      }

      .msla-switch-body-container-wrapper {
        padding-bottom: 10px;
        display: table-row;

        .msla-switch-body-container-wrapper {
          display: table-cell;

          .msla-card-switch-on-body {
            display: table;
          }
        }
        .msla-switch-body-container {
          &.dragging {
            opacity: 0.7;
          }
        }
      }
    }

    .msla-switch-collapsed {
      border: 0;
      min-width: inherit;

      .msla-switch-body-container-wrapper {
        margin-bottom: -15px;

        .msla-switch-body-container {
          &.dragging {
            opacity: 0.7;
          }
        }
      }
    }
  }
}

body.dark {
  .msla-switch {
    .msla-switch-collapsed {
      border-color: @ms-color-neutralTertiary;
    }

    .msla-switch-expanded {
      .msla-card-switch-on-body {
        .msla-card-switch-on-parameters {
          background-color: inherit;
        }
      }
    }

    & > div > div > div > .msla-card {
      background-color: inherit;

      & > .msla-card-body {
        & > .msla-error,
        & > .msla-comment-box,
        & > .msla-information-box-container {
          background-color: @ms-color-white;
        }
      }

      & > .msla-card-body {
        & > .msla-card-switch-on-body {
          background-color: inherit;

          & > .msla-card-switch-on-parameters {
            background-color: @ms-color-white;
          }
        }

        & > .msla-card-switch-on-body-more-cases {
          & > .msla-card-switch-on-parameters {
            background-color: @ms-color-white;
          }
        }
      }
    }
  }

  .msla-card-switch-branch-cell-area {
    .msla-card-scope-body {
      background-color: inherit;
    }
  }
}
