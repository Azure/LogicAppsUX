import Architecture from '../../assets/architecture.png';
import { Meta } from '@storybook/addon-docs';

<Meta title="Docs/VS Code Extension" />

# VS Code Extension - Overview

Azure Logic Apps extension allows to quickly create, debug, manage, and deploy Logic Apps directly from VS Code.

## Table of Contents

- [Prerequisites](#prerequisites)
- [Build/Compile](#build)
- [Run (Dev/Debug)](#run)
- [App architecture](#architecture)
  - [vs-code-designer](#vs-code-designer)
  - [vs-code-designer-react](#vs-code-designer-react)
  - [vs-code-react](#vs-code-react)
  - [vscode-extension](#vscode-extension)
- [Key Insights](#insights)
  - [package.json](#package.json)
  - [registerCommands.ts](#registerCommands.ts)

<h2 id="prerequisites">Prerequisites</h2>

- `git clone` and run `npm install` in the logic_apps_designer repo
- Install nx if you haven't already `npm install -g nx`

- Install [.NET 6.0 SDK](https://dotnet.microsoft.com/en-us/download/dotnet/6.0)
- Install [Azure Functions Core Tools](https://github.com/Azure/azure-functions-core-tools) or `npm i -g azure-functions-core-tools --unsafe-perm true`
- Install the following VS Code Extensions: [Azure Tools](https://marketplace.visualstudio.com/items?itemName=ms-vscode.vscode-node-azure-pack), [Azure Account](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account)
  and [Azure Functions](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions)

<h2 id="build">Build/Compile</h2>

To build, run the following commands from the root of the repo folder:

```bash
npm run build:vscode-designer
```

<h2 id="run">Run (Dev/Debug)</h2>

To run the VS Code extension (in debug mode):

1.  Open the repo folder in VS Code.
2.  Click the 'Run and Debug' icon in the Activity bar on the left side of VS Code. You can also use the shortcut: `Ctrl`+`Shift`+`D`.
3.  Select 'Run Designer Extension In Dev Mode' in the dropdown at the top, then click the 'Start debugging' icon.

> As soon as a debugging session starts, a new VS Code workspace prompts with the running app, now you are able to add [breakpoints](https://code.visualstudio.com/docs/editor/debugging#_breakpoints) and debug it with the [debug actions.](https://code.visualstudio.com/docs/editor/debugging#_debug-actions)

> If you want to debug the app with the common browser's debugging console (e.g. using `console.log()` or check the network calls), you can use the shortcut: `Ctrl`+`Shift`+`I` to reveal it.

> You can learn more about [debuggin VS Code extensions.](https://code.visualstudio.com/docs/editor/debugging)

<h2 id="architecture">App architecture</h2>

<img src={Architecture} alt="App architecture" />

<h3 id="vs-code-designer">vs-code-designer</h3>

Host all the code needed to run the vscode extension.

> You can learn more about [Extensions API](https://code.visualstudio.com/api) and [Extensions anatomy](https://code.visualstudio.com/api/get-started/extension-anatomy)

<h3 id="vs-code-designer-react">vs-code-designer-react</h3>

Host React project exclusively for remote and local desginer webviews. Webview is triggered by the `openDesigner` command.

> You can learn more about [VS Code webviews](https://code.visualstudio.com/api/extension-guides/webview)

<h3 id="vs-code-react">vs-code-react</h3>

Host React project for the extension's webvies. Webviews are triggered by the `openOverview`, `exportLogicApp` and `reviewValidation` commands.

> You can learn more about [VS Code webviews](https://code.visualstudio.com/api/extension-guides/webview)

<h3 id="vscode-extension">vscode-extension</h3>

Host a shared library with helpers and models that are used across all the projects related to the VS Code extension.

> You can use the library by importing `@microsoft/vscode-extension`

<h2 id="insights">Key Insights</h2>

<h3 id="package.json">
  package.json <span>(apps/vs-code-designer/src/package.json)</span>{' '}
</h3>

The package.json file works as the project [manifest](https://code.visualstudio.com/api/references/extension-manifest). Therefore, there are properties you need to check out:

1.  [Activation Events](https://code.visualstudio.com/api/references/activation-events): States when to activate the extension, make sure to set the command or any other event if needed.
2.  [Contribution Points](https://code.visualstudio.com/api/references/contribution-points): These help us to implement the functionalities within Visual Studio Code.
    - [Commands](https://code.visualstudio.com/api/references/contribution-points#contributes.commands): List of commands/functionalities in the extension. Consisting of a title, category, and enabled state. Enablement is expressed with [when clauses](https://code.visualstudio.com/api/references/when-clause-contexts).
    - [Menus](https://code.visualstudio.com/api/references/contribution-points#contributes.menus): Contains the command that should be invoked when selected and the condition under which the item should show.
    - [Configuration](https://code.visualstudio.com/api/references/contribution-points#contributes.configuration): Configuration options that are stated as user or workspace settings.
    - [Views](https://code.visualstudio.com/api/references/contribution-points#contributes.views): States the extension view container in the Azure activity bar.

> You can learn more about [creating new commands.](https://code.visualstudio.com/api/extension-guides/command#creating-new-commands)

<h3 id="registerCommands.ts">
  registerCommands.ts <span>(apps/vs-code-designer/src/app/commands/registerCommands.ts)</span>{' '}
</h3>

This is the main function that help us bind a command ID to a handler function in our extension.
