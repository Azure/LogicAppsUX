// -----------------------------------------------------------
// Copyright (c) Microsoft Corporation.  All rights reserved.
// -----------------------------------------------------------

namespace harness
{
    using Microsoft.Azure.Workflows.Sdk.Agents;
    using Microsoft.Azure.Workflows.Sdk.Agents.Connectors.Msnweather;

    /// <summary>
    /// <%= flowName %> Stateful Workflow.
    /// </summary>
    public static class <%= flowNameClass %>
    {
        /// <summary>
        /// Configures and builds the <%= flowName %> stateful workflow.
        /// </summary>
        public static void AddWorkflow()
        {
            var trigger = WorkflowTriggers.Managed.Msnweather("msnweather").OnCurrentWeatherChange(
                location: () => "Seattle, WA",
                measure: () => measureInput.Temperature,
                when: () => whenInput.IsEqualTo,
                target: () => 70,
                units: () => "I"
            );

            trigger.WithName("weather_trigger");
            trigger.WithRecurrence(new FlowRecurrence
            {
                Frequency = FlowRecurrenceFrequency.Minute,
                Interval = 1
            });
            var builder = WorkflowBuilderFactory.CreateStatefulWorkflow(<%= flowName %>, trigger);

            var compose = WorkflowActions.BuiltIn.Compose(inputs: () => $"The trigger output {trigger.TriggerOutput}");
            builder.AddAction(compose);
        }
    }
}